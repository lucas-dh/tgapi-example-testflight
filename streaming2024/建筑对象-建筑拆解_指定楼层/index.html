<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>图观引擎-API代码示例-建筑对象-建筑拆解_指定楼层</title>
    <link rel="stylesheet" href="../../css/common.css" />
    <script src="../../js/config.js"></script>
    <script src="//www.tuguan.net/public/tgapp/TGApp.min.js"></script>
    <style>
      .app > .avw-loader {
        display: none;
      }

      .app .legends {
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="app" id="app">
      <!-- 头部 -->
      <div class="header-wrap">
        <a href="//www.tuguan.net" target="_blank">图观引擎</a><span>-API代码示例-建筑对象-建筑拆解_指定楼层</span><br />
        <span class="ctrl">点击按钮拆解建筑1的楼层</span>
        <img src="../../image/tuguan.png" />
      </div>
      <!-- 场景 -->
      <div id="container"></div>
      <!-- 底部 -->
      <ul class="legends">
        <li onclick="legendClick(event, {id: 1, value: 'Building01', floor: 1})">建筑拆解楼层1</li>
        <li onclick="legendClick(event, {id: 2, value: 'Building01', floor: 5})">建筑拆解楼层5</li>
        <li onclick="legendClick(event, {id: 10, value: 'Building01', floor: 10})">建筑拆解楼层10</li>
        <li onclick="legendClick(event, {id: 11, value: 'Building01'})">建筑恢复</li>
      </ul>
      <!-- 底部 -->
      <div class="footer-box">
        <span>基于图观™数字孪生应用开发引擎构建 https://www.tuguan.net</span>
        <span>版权所有 北京数字冰雹信息技术有限公司</span>
      </div>
      <!-- 进度条遮罩 -->
      <div class="avw-loader">
        <section><span class="loader-112">L &nbsp; ading </span></section>
      </div>
    </div>
  </body>

  <script>
    // 实例化图观引擎
    let appInstance = new TGApp.App();

    // 声明并赋值页面交互dom变量
    let legendPanel = document.querySelector('.legends');
    let avwLoader = document.querySelector('.avw-loader');

    // 初始化加载图观三维场景服务
    function init() {
      appInstance.initService(
        {
          container: document.getElementById('container'),
          mode: 'streaming',
          token: streamingConfigUE5.shequToken, //StreamingServer服务器获取token
          url: streamingConfigUE5.url, //StreamingServer服务器接口地址和端口，需要进行替换为实际地址
        },
        (result) => {
          appInstance.uniCall(
            'addEventListener',
            {
              eventName: 'onServiceInit',
              callback: (res) => {
                //添加TGAPI事件回调，图观场景服务初始化成功后
                // 隐藏遮罩
                avwLoader.style.display = 'none';
                legendPanel.style.display = 'block';
              },
            },
            (result) => {
              console.log(result);
            }
          );
        }
      );
    }

    // 按钮点击事件
    function legendClick(event, data) {
      // 点击高亮菜单按钮
      document.querySelectorAll('.legends li').forEach((item) => item.classList.remove('active'));
      event.target.classList.add('active');

      let jsonData = {
        buildingId: data.value,
        pitch: 30,
        heading: 340,
        distance: 200,
      };
      // 聚焦楼层
      appInstance.uniCall('focusBuilding', jsonData, (result) => {
        console.log(result);
        if (data.id == 11) {
          let jsonData = {
            id: data.value,
            animation: 1,
          };
          appInstance.uniCall('resetBuildingFloor', jsonData, function (result) {
            console.log(result);
          });
        } else {
          // 拆解楼层
          let jsonData = {
            id: data.value,
            floor: data.floor,
            animation: 1,
          };

          appInstance.uniCall('showBuildingFloor', jsonData, (result) => {
            console.log(result);
          });
        }
      });
    }

    init();
  </script>
</html>
