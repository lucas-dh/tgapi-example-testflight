<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>图观引擎-API代码示例-建筑对象-建筑高亮_楼层</title>
    <link rel="stylesheet" href="../../css/common.css" />
    <script src="../../js/config.js"></script>
    <script src="//www.tuguan.net/public/tgapp/TGApp.min.js"></script>

    <style>
      .app > .avw-loader {
        display: none;
      }

      .app .legends {
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="app" id="app">
      <!-- 头部 -->
      <div class="header-wrap">
        <a href="//www.tuguan.net" target="_blank">图观引擎</a><span>-API代码示例-建筑对象-建筑高亮_楼层</span><br />
        <span class="ctrl">点击按钮拆分到某个楼层并高亮楼层</span>
        <img src="../../image/tuguan.png" />
      </div>
      <!-- 场景 -->
      <div id="container"></div>
      <!-- 按钮菜单 -->
      <ul class="legends">
        <li onclick="legendClick(event, 0)">高亮楼层1</li>
        <li onclick="legendClick(event, 1)">高亮楼层5</li>
        <li onclick="legendClick(event, 2)">高亮楼层10</li>
        <li onclick="legendClick(event, 3)">取消高亮</li>
      </ul>
      <!-- 底部 -->
      <div class="footer-box">
        <span>基于图观™数字孪生应用开发引擎构建 https://www.tuguan.net</span>
        <span>版权所有 北京数字冰雹信息技术有限公司</span>
      </div>
      <!-- 进度条遮罩 -->
      <div class="avw-loader">
        <section><span class="loader-112">L &nbsp; ading </span></section>
      </div>
    </div>
  </body>

  <script>
    // 实例化图观引擎
    let appInstance = new TGApp.App();

    // 声明并赋值页面交互dom变量
    let legendPanel = document.querySelector('.legends');
    let avwLoader = document.querySelector('.avw-loader');

    let legendList = [
      {
        id: 1,
        action: '高亮楼层1',
        value: 'Building01',
        floor: 1,
        floorName: '楼层1',
        iconName: 'site_02',
        coord: [116.34949173620254, 40.08309372687022],
        coordZ: 10,
      },
      {
        id: 2,
        action: '高亮楼层5',
        value: 'Building01',
        floor: 5,
        floorName: '楼层5',
        iconName: 'site_02',
        coord: [116.34947858875564, 40.083101377491],
        coordZ: 30,
      },
      {
        id: 3,
        action: '高亮楼层10',
        value: 'Building01',
        floor: 10,
        floorName: '楼层10',
        iconName: 'site_02',
        coord: [116.34948143134089, 40.08309104100405],
        coordZ: 60,
      },
      {
        id: 4,
        action: '取消高亮',
        value: 'Building01',
        floor: 10,
      },
    ];

    // 初始化加载图观三维场景服务
    function init() {
      // 初始化图观App
      appInstance = new TGApp.App();
      appInstance.initService(
        {
          container: document.getElementById('container'),
          mode: 'streaming',
          token: streamingConfigUE5.shequToken, //StreamingServer服务器获取token
          url: streamingConfigUE5.url, //StreamingServer服务器接口地址和端口，需要进行替换为实际地址
        },
        (result) => {
          appInstance.uniCall(
            'addEventListener',
            {
              eventName: 'onServiceInit',
              callback: (res) => {
                //添加TGAPI事件回调，图观场景服务初始化成功后
                // 隐藏遮罩
                avwLoader.style.display = 'none';
                legendPanel.style.display = 'block';
              },
            },
            (result) => {
              console.log(result);
            }
          );
        }
      );
    }

    function legendClick(event, index) {
      // 点击高亮菜单按钮
      Array.from(legendPanel.children).forEach((item) => item.classList.remove('active'));
      event.target.classList.add('active');

      data = legendList[index];

      appInstance.uniCall('clearOverlayType', { overlayType: 'all' }, (res) => {});
      // 取消高亮
      if (data.id == 4) {
        appInstance.uniCall(
          'setCamera',
          {
            coordType: 0,
            coordTypeZ: 0,
            centerCoord: [116.3488375, 40.0842803], //以深圳湾经纬度为例
            coordZ: -30.79,
            distance: 780.62,
            pitch: 30.85,
            heading: 330.2,
            fly: true,
            duration: 0.5,
          },
          (result) => {
            console.log(result);
          }
        );
        appInstance.uniCall(
          'resetBuildingFloor',
          {
            id: 'Building',
            animation: 1,
          },
          function (result) {
            console.log(result);
          }
        );
        appInstance.uniCall(
          'highlightFloor',
          {
            id: data.value,
            floor: data.floor,
            type: 'none',
          },
          (result) => {
            console.log(result);
          }
        );
        return;
      }

      legendList[3].value = data.value;
      legendList[3].floor = data.floor;
      // 高亮楼层
      let jsonData = {
        buildingId: data.value,
        floor: data.floor,
        pitch: 30,
        heading: 0,
        distance: 100,
      };
      appInstance.uniCall('focusFloor', jsonData, (result) => {
        console.log(result);

        appInstance.uniCall(
          'showBuildingFloor',
          {
            id: data.value,
            floor: data.floor,
            animation: 1,
          },
          (result) => {
            appInstance.uniCall(
              'highlightFloor',
              {
                id: data.value,
                floor: data.floor,
                type: 'style1',
              },
              (result) => {
                console.log(result);
                addLand(data);
              }
            );
          }
        );
      });
    }

    // 添加地标点
    function addLand(data) {
      let jsonData = {
        id: data.floorName,
        coordType: 0,
        coordTypeZ: 0,
        iconName: data.iconName,
        autoScale: false,
        visible: true,
        label: data.floorName,
        iconScale: 1,
        labelScale: 1,
        tag: data.floorName, // 用户自定标签，用户保存用户的扩展数据
        coord: data.coord, //以深圳湾经纬度为例
        coordZ: data.coordZ,
      };

      appInstance.uniCall('addLandmark', jsonData, (result) => {
        console.log(result);
      });
    }

    init();
  </script>
</html>
