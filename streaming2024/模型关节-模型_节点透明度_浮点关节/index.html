<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>图观引擎-API代码示例-模型关节-模型_节点透明度_浮点关节</title>
    <link rel="stylesheet" href="../../css/common.css" />
    <link rel="stylesheet" href="../../css/slider.css" />
    <script src="../../js/config.js"></script>
    <script src="../../lib/slider.js"></script>
    <script src="//www.tuguan.net/public/tgapp/TGApp.min.js"></script>
    <style>
      ::selection {
        background: transparent !important;
      }
      .app > .avw-loader {
        display: none;
      }
      .legends {
        width: 200px;
        background-color: rgba(0, 0, 0, 0.5);
        color: #fff;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="app" id="app">
      <!-- 头部 -->
      <div class="header-wrap">
        <a href="//www.tuguan.net" target="_blank">图观引擎</a><span>-API代码示例-模型关节-模型_节点透明度_浮点关节</span><br />
        <span class="ctrl">拖动滑块查看节点透明度变化效果</span>
        <img src="../../image/tuguan.png" />
      </div>
      <!-- 场景 -->
      <div id="container"></div>
      <!-- 底部 -->
      <ul class="legends">
        <p>节点透明度</p>
        <div id="slider"></div>
      </ul>
      <!-- 底部 -->
      <div class="footer-box">
        <span>基于图观™数字孪生应用开发引擎构建 https://www.tuguan.net</span>
        <span>版权所有 北京数字冰雹信息技术有限公司</span>
      </div>
      <!-- 进度条遮罩 -->
      <div class="avw-loader">
        <section><span class="loader-112">L &nbsp; ading </span></section>
      </div>
    </div>
  </body>
  <script>
    // 实例化图观引擎
    var appInstance = new TGApp.App();

    // 声明并赋值页面交互dom变量
    var legendPanel = document.querySelector('.legends');
    var avwLoader = document.querySelector('.avw-loader');

    // 初始化服务
    function init() {
      appInstance.initService(
        {
          name: '默认服务',
          container: document.querySelector('#container'),
          mode: 'streaming',
          token: streaming2024Config.jxbToken, //StreamingServer服务器获取token
          url: streaming2024Config.url, //StreamingServer服务器接口地址和端口，需要进行替换为实际地址
        },
        (result) => {
          window.appInstance.uniCall(
            'addEventListener',
            {
              eventName: 'onServiceInit',
              callback: (res) => {
                avwLoader.style.display = 'flex';
                appInstance.uniCall(
                  'addEventListener',
                  {
                    eventName: 'onStateSwitch',
                    callback: function (event) {
                      console.log(event);
                      avwLoader.style.display = 'none';
                    },
                  },
                  (result) => {
                    console.log(result);
                  }
                );
                window.appInstance.uniCall(
                  'switchState',
                  {
                    name: '节点透明-数值',
                    sceneName: '关节控制',
                  },
                  (result) => {
                    console.log(result);
                    legendPanel.style.display = 'block';
                  }
                );
              },
            },
            (result) => {
              console.log(result);
            }
          );
        }
      );
    }

    // 设置节点
    function legendClick(value) {
      let jsonData = {
        id: '机械臂',
        layerId: '',
        duration: 0,
        data: [
          {
            articulation: '节点透明_数值型',
            type: 'float',
            value: value,
          },
        ],
      };
      appInstance.uniCall('setModelArticulation', jsonData, (result) => {
        console.log(result);
      });
    }
    initSlider('#slider', (value) => {
      legendClick(value);
    });
    init();
  </script>
</html>
