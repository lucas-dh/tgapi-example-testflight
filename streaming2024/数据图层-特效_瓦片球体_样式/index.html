<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>图观引擎-API代码示例-数据图层-特效_瓦片球体_样式</title>
    <link rel="stylesheet" href="../../css/common.css" />
    <script src="../../js/config.js"></script>
    <script src="//www.tuguan.net/public/tgapp/TGApp.min.js"></script>
    <style>
      ::selection {
        background: transparent !important;
      }
      .legends {
        display: none;
      }
      .legends input {
        pointer-events: none;
      }
    </style>
  </head>

  <body>
    <div class="app" id="app">
      <!-- 头部 -->
      <div class="header-wrap">
        <a href="https://www.tuguan.net" target="_blank">图观引擎</a><span>-API代码示例-数据图层-特效_瓦片球体_样式</span><br />
        <span>展示特效全部枚举样式02</span>
        <img src="../../image/tuguan.png" />
      </div>
      <!-- 场景 -->
      <div id="container"></div>
      <!-- 图例 -->
      <ul class="legends">
        <li onclick="legendClick(this,'Radar01')" class="Markerli">
          <span>Radar01</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Revolve01')" class="Markerli">
          <span>Revolve01</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Revolve02')" class="Markerli">
          <span>Revolve02</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Revolve03')" class="Markerli">
          <span>Revolve03</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Revolve04')" class="Markerli">
          <span>Revolve04</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Spread01')" class="Markerli">
          <span>Spread01</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Spread02')" class="Markerli">
          <span>Spread02</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Spread03')" class="Markerli">
          <span>Spread03</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Spread04')" class="Markerli">
          <span>Spread04</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Spread05')" class="Markerli">
          <span>Spread05</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Spread06')" class="Markerli">
          <span>Spread06</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Spread07')" class="Markerli">
          <span>Spread07</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Spread08')" class="Markerli">
          <span>Spread08</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Spread09')" class="Markerli">
          <span>Spread09</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Square01')" class="Markerli">
          <span>Square01</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Explosion')" class="Markerli">
          <span>Explosion</span>
          <input type="checkbox" checked="checked" />
        </li>
        <li onclick="legendClick(this,'Flame')" class="Markerli">
          <span>Flame</span>
          <input type="checkbox" checked="checked" />
        </li>
      </ul>
      <!-- 底部 -->
      <div class="footer-box">
        <span>基于图观™数字孪生应用开发引擎构建 https://www.tuguan.net</span>
        <span>版权所有 北京数字冰雹信息技术有限公司</span>
      </div>
    </div>
  </body>
  <script>
    // 实例化图观引擎
    var appInstance = new TGApp.App();

    // 声明并赋值页面交互dom变量
    var legends = [
      {
        Ids: 'Radar01',
        coord: [82, 45],
      },
      {
        Ids: 'Revolve01',
        coord: [94, 45],
      },
      {
        Ids: 'Revolve02',
        coord: [106, 45],
      },
      {
        Ids: 'Revolve03',
        coord: [118, 45],
      },
      {
        Ids: 'Revolve04',
        coord: [130, 45],
      },
      {
        Ids: 'Spread01',
        coord: [82, 39],
      },
      {
        Ids: 'Spread02',
        coord: [94, 39],
      },
      {
        Ids: 'Spread03',
        coord: [106, 39],
      },
      {
        Ids: 'Spread04',
        coord: [118, 39],
      },
      {
        Ids: 'Spread05',
        coord: [82, 33],
      },
      {
        Ids: 'Spread06',
        coord: [94, 33],
      },
      {
        Ids: 'Spread07',
        coord: [106, 33],
      },
      {
        Ids: 'Spread08',
        coord: [118, 33],
      },
      {
        Ids: 'Spread09',
        coord: [82, 27],
      },
      {
        Ids: 'Square01',
        coord: [94, 27],
      },
      {
        Ids: 'Explosion',
        coord: [106, 27],
      },
      {
        Ids: 'Flame',
        coord: [118, 27],
      },
    ];
    var legendPanel = document.querySelector('.legends');

    // 初始化服务
    function init() {
      appInstance.initService(
        {
          container: document.querySelector('#container'),
          mode: 'streaming',
          token: streaming2024Config.globalgisToken, //StreamingServer服务器获取token
          url: streaming2024Config.url, //StreamingServer服务器接口地址和端口，需要进行替换为实际地址
        },
        (result) => {
          window.appInstance.uniCall(
            'addEventListener',
            {
              eventName: 'onServiceInit',
              callback: (res) => {
                legendPanel.style.display = 'block';
                let jsonData = {
                  lightPower: 1, // 图层对象中如果带有发光特性的光的亮度，值域范围0.0 - 10.0，默认1.0
                  isLayerTopMost: false, // 图层是否盖在所有模型的最前面，此选项作用于全部图层
                  divTipMovingDelay: 200, // 使用HTML Div方法添加的Tip标牌和流画面同步延迟，默认200（单位毫秒）
                  labelColorStyle: 'nonlinear',
                };

                appInstance.uniCall('setSceneEffect', jsonData, (result) => {
                  console.log(result);
                  legends.forEach((item) => {
                    add3DMarker(item);
                  });
                });
              },
            },
            (result) => {
              console.log(result);
            }
          );
        }
      );
    }

    // 添加特效
    function add3DMarker(item) {
      let jsonData = {
        id: item.Ids,
        coordType: 0,
        coordTypeZ: 0,
        alpha: 1,
        scale: 160000,
        type: item.Ids,
        titleText: '',
        titleColor: '#ffffff',
        titleBackgroundColor: '#333333',
        tag: 'custominfo',
        coord: item.coord,
        coordZ: 0,
        visible: true,
      };

      appInstance.uniCall('add3DMarker', jsonData, (result) => {
        console.log(result);
      });
    }

    //控制显示隐藏
    function legendClick(li, Ids, number) {
      li.children[1].checked = !li.children[1].checked;
      let jsonData = {
        id: Ids,
        overlayType: '3DMarker',
        visible: li.children[1].checked,
      };
      appInstance.uniCall('setOverlayVisibility', jsonData, (result) => {
        console.log(result);
      });
    }

    // 获取数据
    function getJsonData(url) {
      return new Promise((resolve) => {
        fetch(url, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' },
        })
          .then((response) => {
            if (response.ok) {
              return response.json();
            }
          })
          .then((res) => {
            resolve(res);
          });
      });
    }

    init();
  </script>
</html>
